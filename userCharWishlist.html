<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Genshin Impact Character Guide">
    <meta name="keywords" content="Genshin Impact, Character Tracker">
    <title>5-Star Genshin Character Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet"> 
     <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="assets/Logo.png">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="userCharstyle.css">

</head>


<body>

    <!-- LOGIN POPUP -->
    <div class="overlay" id="popupOverlay">
        <div class="popup">
            <span class="close-btn" id="closePopup">&times;</span>


            <h1 class="title">Sign-up Page</h1>


            <form id="loginForm">
                <fieldset>
                    <legend>Credentials</legend>

                    <label>Email
                        <input type="email" id="email" required>
                    </label><br><br>


                    <label>Password
                        <input type="password" required>
                    </label>
                </fieldset>

                <fieldset>
                    <label>Server
                        <select required>
                            <option value="" disabled selected></option>
                            <option>America</option>
                            <option>Europe</option>
                            <option>Asia</option>
                            <option>TW, HK, MO</option>
                        </select>
                    </label><br><br>

                    <label>UID
                        <input type="number" required>
                    </label><br><br>
                </fieldset>
                <button type="submit">Log In</button>
            </form>
        </div>
    </div>


    <!-- CHARACTER TRACKER -->
    <div style="display: flex; gap: 32px; align-items: flex-start;" id="tracker-section">
        <div style="flex: 1;" id="left">
            <h1>Character Tracker</h1>
            <div class="characterTracker">
                <div class="character">
                <img src="teamIcons/albedo-icon.png" alt="albedo" draggable="true" class="character-img" id="img1">
                <img src="teamIcons/alhaitham-icon.png" alt="alhaitham" draggable="true" class="character-img" id="img2">
                <img src="teamIcons/arle-icon.png" alt="arle" draggable="true" class="character-img" id="img3">
                <img src="teamIcons/ayaka-icon.png" alt="ayaka" draggable="true" class="character-img" id="img4">
                <img src="teamIcons/ayato-icon.png" alt="ayato" draggable="true" class="character-img" id="img5">
                <img src="teamIcons/baizhu-icon.png" alt="baizhu" draggable="true" class="character-img" id="img6">
                <img src="teamIcons/chasca-icon.png" alt="chasca" draggable="true" class="character-img" id="img7">
                <img src="teamIcons/chiori-icon.png" alt="chiori" draggable="true" class="character-img" id="img8">
                <img src="teamIcons/citlali-icon.png" alt="citlali" draggable="true" class="character-img" id="img9">
                <img src="teamIcons/clorinde-icon.png" alt="clorinde" draggable="true" class="character-img" id="img10">
                <img src="teamIcons/cyno-icon.png" alt="cyno" draggable="true" class="character-img" id="img11">
                <img src="teamIcons/dehya-icon.png" alt="dehya" draggable="true" class="character-img" id="img12">
                <img src="teamIcons/diluc-icon.png" alt="diluc" draggable="true" class="character-img" id="img13">
                <img src="teamIcons/durin-icon.png" alt="durin" draggable="true" class="character-img" id="img14">
                <img src="teamIcons/emilie_icon.png" alt="emilie" draggable="true" class="character-img" id ="img15">
                <img src="teamIcons/escoffier-icon.png" alt= "escoffier " draggable ="true " class ="character-img " id ="img16">
                <img src="teamIcons/eula-icon.png" alt ="eula " draggable ="true " class ="character-img " id ="img17">
                <img src="teamIcons/furina-icon.png" alt="furina" draggable="true" class="character-img" id="img18">
                <img src="teamIcons/ganyu-icon.png" alt="ganyu" draggable="true" class="character-img" id="img19">
                <img src="teamIcons/hu tao-icon.png" alt="hu tao" draggable="true" class="character-img" id="img20">
                <img src="teamIcons/itto-icon.png" alt="itto" draggable="true" class="character-img" id="img21">
                <img src="teamIcons/jean-icon.png" alt="jean" draggable="true" class="character-img" id="img22">
                <img src="teamIcons/kazuha-icon.png" alt="kazuha" draggable="true" class="character-img" id="img23">
                <img src="teamIcons/keqing-icon.png" alt="keqing" draggable="true" class="character-img" id ="img24">
                <img src="teamIcons/kinich-icon.png" alt="kinich" draggable="true" class="character-img" id="img25">
                <img src="teamIcons/klee-icon.png" alt="klee" draggable="true" class="character-img" id="img26">
                <img src="teamIcons/kokomi-icon.png" alt="kokomi" draggable="true" class="character-img" id="img27">
                <img src="teamIcons/lyney-icon.png" alt="lyney" draggable="true" class="character-img" id="img28">
                <img src="teamIcons/mavuika-icon.png" alt="mavuika" draggable="true" class="character-img" id ="img29">
                <img src="teamIcons/mizuki-icon.png" alt="mizuki" draggable="true" class="character-img" id ="img30">
                <img src="teamIcons/mona-icon.png" alt="mona" draggable="true" class="character-img" id ="img31">
                <img src="teamIcons/mualani-icon.png" alt="mualani" draggable ="true " class ="character-img " id ="img32">
                <img src ="teamIcons/nahida_icon.png " alt ="nahida " draggable ="true " class ="character-img " id ="img33">
                <img src ="teamIcons/navia-icon.png " alt ="navia " draggable ="true " class ="character-img " id ="img34">
                <img src="teamIcons/neuvi-icon.png" alt="neuvilette" draggable="true" class="character-img" id="img35">
                <img src="teamIcons/nilou-icon.png" alt="nilou" draggable="true" class="character-img" id="img36">
                <img src="teamIcons/raiden-icon.png" alt="raiden" draggable="true" class="character-img" id="img37">
                <img src="teamIcons/shenhe-icon.png" alt="shenhe" draggable="true" class="character-img" id="img38">
                <img src="teamIcons/sigewinne-icon.png" alt="sigewinne" draggable="true" class="character-img" id="img39">
                <img src="teamIcons/skirk-icon.png" alt="skirk" draggable="true" class="character-img" id="img40">
                <img src="teamIcons/tartaglia-icon.png" alt="tartaglia" draggable="true" class="character-img" id="img41">
                <img src="teamIcons/tighnari-icon.png" alt="tighnari" draggable="true" class="character-img" id="img42">
                <img src="teamIcons/varessa-icon.png" alt="varessa" draggable="true" class="character-img" id ="img43">
                <img src="teamIcons/venti-icon.png" alt="venti" draggable="true" class="character-img" id="img44">
                <img src="teamIcons/wanderer-icon.png" alt="wanderer" draggable="true" class="character-img" id="img45">
                <img src="teamIcons/wriothesley-icon.png" alt="wriothesley" draggable="true" class="character-img" id="img46">
                <img src="teamIcons/xianyun-icon.png" alt="xianyun" draggable="true" class="character-img" id="img47">
                <img src="teamIcons/xiao-icon.png" alt="xiao" draggable="true" class="character-img" id="img48">
                <img src="teamIcons/xilonen-icon.png" alt="xilonen" draggable="true" class="character-img" id ="img49">
                <img src="teamIcons/yaemiko-icon.png" alt="yae" draggable="true" class="character-img" id="img50">
                <img src="teamIcons/yoimiya-icon.png" alt="yoimiya" draggable="true" class="character-img" id="img51">
                <img src="teamIcons/zhongli-icon.png" alt="zhongli" draggable="true" class="character-img" id="img52">
                </div>
            </div>
        </div>
        <div id="right" style="position: relative; display: block; margin: 3vh; overflow-x: hidden; padding-top: 12px; overflow-y: auto; box-sizing: border-box; height: 100vh; width: 33vw; flex-shrink:0;">
            <h3>My wanted Characters</h3>
        </div>
    </div>


    <!-- JAVASCRIPT -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const overlay = document.getElementById("popupOverlay");
            const closeBtn = document.getElementById("closePopup");
            const form = document.getElementById("loginForm");
            const tracker = document.getElementById("tracker-section");
            const characters = document.querySelectorAll(".character");
            closeBtn.addEventListener("click", () => overlay.style.display = "none");
            form.addEventListener("submit", function (e) {
                e.preventDefault();
                overlay.style.display = "none";
                tracker.style.display = "block";
                loadSelections(); 
            });

           // drag n  drop
            const images = document.querySelectorAll(".character-img");
            const leftContainer = document.getElementById("left");
            const rightContainer = document.getElementById("right");

            images.forEach(img => {
                img.addEventListener("dragstart", (e) => {
                    e.dataTransfer.setData("text", e.target.id);
                });
            });

            [leftContainer, rightContainer].forEach(container => {
                container.addEventListener("dragover", (e) => {
                    e.preventDefault();
                });
                container.addEventListener("drop", (e) => {
                    e.preventDefault();
                    const id = e.dataTransfer.getData("text");
                    const draggable = document.getElementById(id);
                    if (draggable && draggable.classList.contains("character-img")) container.appendChild(draggable);
                    save();
                });
            });
        });
        
            let username = document.getElementById("email").value;

            if (username === null || username === "") {
                username = "guest";
            }
        
        // save selections to localStorage
        let accountList = {}; 

        function readLocalStorage(){
        let acctString = localStorage.getItem("accounts");
        if (!acctString) { 
            accountList = {};
        }

        else {
            accountList = JSON.parse(acctString);
        }

            return accountList; 
        }

        // Call readLocalStorage on page load
        readLocalStorage();

        function writeLocalStorage(form){ 

        const data = new FormData(form); 
        const obj = Object.fromEntries(data.entries()); // get all the data from the form; converts to object data structure
        
        accountList[obj.email] = {}; // initialize new entry for account; key is username
        for (let key in obj) { 
            if (key != "email") { 
                accountList[obj.email][key] = obj[key];
            }
        }
        
        console.log(accountList); 
        acctString = JSON.stringify(accountList);
        localStorage.setItem("accounts", acctString);

        
    };

        function getEmailKey() {
            if (!currentEmail) return "containers-guest";
            return "containers-" + currentEmail.toLowerCase();
        }

        function save() {
            const left = document.getElementById("left");
            const right = document.getElementById("right");

            let leftItems = [];
            let rightItems = [];

            for (let i = 0; i < left.children.length; i++) {
                leftItems.push(left.children[i].id);
            }

            for (let i = 0; i < right.children.length; i++) {
                rightItems.push(right.children[i].id);
            }

            const data = {
                left: leftItems,
                right: rightItems
            };

            localStorage.setItem(getEmailKey(), JSON.stringify(data));
            }


        // On login, set currentEmail and load state for that email
        document.getElementById("loginForm").addEventListener("submit", function (e) {
            const emailInput = document.getElementById("email");
            currentEmail = emailInput.value.trim();
            loadState();
        });

      
        window.addEventListener("DOMContentLoaded", function() {
            currentEmail = null;
            loadState();
        });

    </script>
    
    <div class="nav-buttons">
        <button onclick="window.location.href='userCharTracker.html'">Show Current Characters</button>
        <button onclick="window.location.href='userCharWishlist.html'">Show Wanted Characters</button>
      </div>
      
</body>
</html>
